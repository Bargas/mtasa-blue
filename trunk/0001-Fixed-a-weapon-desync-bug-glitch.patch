From f27d896788de668643b102427ffeec30f533a60b Mon Sep 17 00:00:00 2001
From: Talidan <danthetaliban@gmail.com>
Date: Thu, 11 Feb 2010 02:07:19 +0000
Subject: [PATCH] Fixed a weapon desync bug/glitch

---
 MTA10/mods/shared_logic/CClientPed.cpp |   11 +++++++++++
 1 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/MTA10/mods/shared_logic/CClientPed.cpp b/MTA10/mods/shared_logic/CClientPed.cpp
index 8d0391f..32f2ca6 100644
--- a/MTA10/mods/shared_logic/CClientPed.cpp
+++ b/MTA10/mods/shared_logic/CClientPed.cpp
@@ -2215,6 +2215,17 @@ void CClientPed::StreamedInPulse ( void )
         else
         {
             m_ulLastTimeAimed = 0;
+            // If we have the aim button pressed but aren't aiming, we're probably sprinting
+            // If we're sprinting with an MP5,Deagle,Fire Extinguisher,Spray can, we shouldnt be able to shoot 
+            // These weapons are weapons you can run with, but can't run with while aiming
+            // This fixes a weapon desync bug involving aiming and sprinting packets arriving simultaneously
+            eWeaponType iCurrentWeapon = GetCurrentWeaponType ();
+            if ( Current.RightShoulder1 != 0 && 
+                ( iCurrentWeapon == 29 || iCurrentWeapon == 24 || iCurrentWeapon == 23 || iCurrentWeapon == 41 || iCurrentWeapon == 42 ) )
+            {
+                Current.ButtonCircle = 0;
+                Current.LeftShoulder1 = 0;
+            }
         }
 
         // Remember when we start the crouching if we're crouching.
-- 
1.6.4.msysgit.0

